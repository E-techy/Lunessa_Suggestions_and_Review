generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

/// ---------------- REVIEWS ----------------

/// Global statistics (only a single object stored here)
model ReviewStats {
  id              String @id @default(auto()) @map("_id") @db.ObjectId
  averageRating   Int
  totalReviews    Int
  positiveReviews Int
}

/// Admin model for managing reviews
model ReviewsAdmin {
  id       String @id @default(auto()) @map("_id") @db.ObjectId
  username String @unique                          // ğŸ”‘ unique username
  apiKey   String
  role     String                                  // e.g. "admin", "moderator"

  // âš ï¸ Removed @@index([username]) since @unique already indexes it
}

/// Individual Review documents
model Review {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  reviewID      String   @unique                        // ğŸ”‘ unique review identifier
  name          String
  username      String
  createdAt     DateTime @default(now())                // ğŸ“Œ review creation timestamp
  lastModified  DateTime @updatedAt                     // ğŸ“Œ auto-updates on edit
  comment       String
  ratingStar    Int
  files         File[]  
  reviewType    String

  @@index([createdAt], map: "idx_review_createdAt")     // fast recent reviews
  @@index([username], map: "idx_review_username")       // fast search by username
  // âš ï¸ Removed @@index([reviewID]) since reviewID is already @unique
}

/// File structure (reusable for reviews/suggestions)
type File {
  fileName String
  fileType String // e.g. "photo", "pdf", "txt", "doc"
  fileData Bytes   // stores the actual file binary data
  fileSize Int     // size in KB or Bytes
}

/// ---------------- SUGGESTIONS ----------------

/// Main Suggestion model
model Suggestion {
  id                    String   @id @default(auto()) @map("_id") @db.ObjectId
  suggestionId          String   @unique                         // ğŸ”‘ unique suggestion identifier
  username              String
  name                  String
  createdAt             DateTime @default(now())
  lastModified          DateTime @updatedAt
  suggestionCategory    String
  suggestionDescription String
  files                 File[]  
  suggestionStatus      String   // e.g. "live", "completed", "pending"
  accepted              Boolean  @default(false)

  // âš ï¸ Removed @@index([suggestionId]) since it's already @unique
  @@index([username], map: "idx_suggestion_username")           // ğŸ”¥ fast search by username
  @@index([createdAt], map: "idx_suggestion_createdAt")         // ğŸ”¥ fast recent suggestions
  @@index([suggestionCategory], map: "idx_suggestion_category") // ğŸ”¥ fast search by category
}

/// Tracker for live suggestions
model LiveSuggestion {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  suggestionId   String   @unique                        // ğŸ”‘ unique suggestion identifier
  createdAt      DateTime @default(now())
  acceptedAt     DateTime?
  resolutionDate DateTime?

  @@index([createdAt], map: "idx_live_createdAt")           // fast recent/older queries
  @@index([resolutionDate], map: "idx_live_resolutionDate") // fast search by resolution date
  // âš ï¸ Removed @@index([suggestionId]) since it's already @unique
}

/// Tracker for completed suggestions
model CompletedSuggestion {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  suggestionId   String   @unique                        // ğŸ”‘ unique suggestion identifier
  createdAt      DateTime @default(now())
  acceptedAt     DateTime?
  resolutionDate DateTime?

  @@index([createdAt], map: "idx_completed_createdAt")           // fast recent/older queries
  @@index([resolutionDate], map: "idx_completed_resolutionDate") // fast search by resolution date
  // âš ï¸ Removed @@index([suggestionId]) since it's already @unique
}
